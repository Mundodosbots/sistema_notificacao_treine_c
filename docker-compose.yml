version: '3.8'

services:
  nextfit-scheduler:
    image: nextfit-scheduler:latest
    deploy:
      replicas: 1
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 3
        window: 120s
    environment:
      - TZ=America/Sao_Paulo
      - DATA_DIR=/app/data
      - LOG_DIR=/app/logs
      # API NextFit (valor vem das variáveis do Portainer / stack.env)
      - NEXTFIT_API_KEY=${NEXTFIT_API_KEY}
      # API de Mensagens (mundodosbots)
      - MESSAGE_API_TOKEN=${MESSAGE_API_TOKEN}
      # Flow IDs para cada tipo de mensagem
      - FLOW_ID_VENCENDO_HOJE=${FLOW_ID_VENCENDO_HOJE}
      - FLOW_ID_VENCENDO_3_DIAS=${FLOW_ID_VENCENDO_3_DIAS}
      - FLOW_ID_VENCIDO_3_DIAS=${FLOW_ID_VENCIDO_3_DIAS}
      - FLOW_ID_VENCIDO_5_DIAS=${FLOW_ID_VENCIDO_5_DIAS}
      - FLOW_ID_VENCIDO_30_DIAS=${FLOW_ID_VENCIDO_30_DIAS}
      - FLOW_ID_ANIVERSARIANTE=${FLOW_ID_ANIVERSARIANTE}
      # Nomes dos campos customizados na API de mensagens
      - MESSAGE_FIELD_1=${MESSAGE_FIELD_1}
      - MESSAGE_FIELD_2=${MESSAGE_FIELD_2}
      - MESSAGE_FIELD_3=${MESSAGE_FIELD_3}
      - MESSAGE_FIELD_4=${MESSAGE_FIELD_4}
      - MESSAGE_FIELD_5=${MESSAGE_FIELD_5}
    volumes:
      # Volume persistente para dados JSON (usar volume externo existente)
      - nextfit-data:/app/data
      # Volume para logs (usar volume externo existente)
      - nextfit-logs:/app/logs
    networks:
      - CLNet

volumes:
  nextfit-data:
    external: true
    name: nextfit-data  # Usar o volume externo existente
  nextfit-logs:
    external: true
    name: nextfit-logs  # Usar o mesmo volume externo ou criar um específico se necessário

networks:
  CLNet:
    external: true
    name: CLNet  # Usar a rede externa existente
