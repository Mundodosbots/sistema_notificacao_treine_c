version: '3.8'

services:
  nextfit-scheduler:
    image: nextfit-scheduler:latest
    deploy:
      replicas: 1
      restart_policy:
        condition: unless-stopped
    environment:
      - TZ=America/Sao_Paulo
      - DATA_DIR=/app/data
      - LOG_DIR=/app/logs
      # API NextFit (valor vem das vari√°veis do Portainer / stack.env)
      - NEXTFIT_API_KEY=${NEXTFIT_API_KEY}
      # API de Mensagens (mundodosbots)
      - MESSAGE_API_TOKEN=${MESSAGE_API_TOKEN}
      # Flow IDs para cada tipo de mensagem
      - FLOW_ID_VENCENDO_HOJE=${FLOW_ID_VENCENDO_HOJE}
      - FLOW_ID_VENCENDO_3_DIAS=${FLOW_ID_VENCENDO_3_DIAS}
      - FLOW_ID_VENCIDO_3_DIAS=${FLOW_ID_VENCIDO_3_DIAS}
      - FLOW_ID_VENCIDO_5_DIAS=${FLOW_ID_VENCIDO_5_DIAS}
      - FLOW_ID_VENCIDO_30_DIAS=${FLOW_ID_VENCIDO_30_DIAS}
      - FLOW_ID_ANIVERSARIANTE=${FLOW_ID_ANIVERSARIANTE}
      # Nomes dos campos customizados na API de mensagens
      - MESSAGE_FIELD_1=${MESSAGE_FIELD_1}
      - MESSAGE_FIELD_2=${MESSAGE_FIELD_2}
      - MESSAGE_FIELD_3=${MESSAGE_FIELD_3}
      - MESSAGE_FIELD_4=${MESSAGE_FIELD_4}
      - MESSAGE_FIELD_5=${MESSAGE_FIELD_5}
    volumes:
      # Volume persistente para dados JSON
      - nextfit-data:/app/data
      # Volume para logs
      - nextfit-logs:/app/logs
    networks:
      - nextfit-network

volumes:
  nextfit-data:
  nextfit-logs:

networks:
  nextfit-network:
    driver: overlay
